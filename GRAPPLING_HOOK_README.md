# Система Крюк-Кошки для Godot

## Описание

Система крюк-кошки позволяет игроку запускать крюк в направлении курсора мыши. Крюк может цепляться за объекты в игровом мире и предоставляет основу для дальнейшего развития механик зацепления.

## Файлы системы

- `Scripts/Player/grappling_hook.gd` - Основная система крюк-кошки
- `Scripts/Player/player_grappling_integration.gd` - Интеграция крюк-кошки с игроком
- `Scripts/Player/player.gd` - Основной скрипт игрока (обновлен для подключения)
- `Scripts/test_object.gd` - Тестовый объект для проверки зацепления
- `Scripts/demo_scene.gd` - Демонстрационная сцена

## Архитектура

### Разделение ответственности

- **`GrapplingHook`** - Основная логика крюка (полет, коллизии, состояния)
- **`PlayerGrapplingIntegration`** - Интеграция с игроком (ввод, сигналы, управление)
- **`Player`** - Основная логика игрока + простое подключение крюка

### Преимущества архитектуры

- ✅ **Модульность** - каждый компонент отвечает за свою область
- ✅ **Переиспользование** - интеграцию можно использовать с разными игроками
- ✅ **Чистота кода** - основной скрипт игрока остается простым
- ✅ **Расширяемость** - легко добавлять новые механики

## Управление

- **WASD** - Движение игрока
- **Правая кнопка мыши** - Запуск крюка в направлении курсора
- **Пробел** - Додж в направлении движения (только если игрок движется)
- **Escape** - Отсоединение крюка (если активен)
- **R** - Перезагрузка сцены (в демо)

### Примечание по управлению

- Крюк запускается **только правой кнопкой мыши** - это исключает конфликты с другими механиками
- Пробел используется **исключительно для доджа**
- Escape используется для отмены/отсоединения крюка

## Особенности

### Базовая функциональность

- ✅ Запуск крюка по правой кнопке мыши
- ✅ Полет крюка в направлении курсора
- ✅ Коллизия с объектами
- ✅ Визуализация веревки
- ✅ Ограничение максимальной дистанции
- ✅ Автоматический возврат при превышении дистанции

### Состояния крюка

1. **IDLE** - Крюк неактивен
2. **FLYING** - Крюк летит к цели
3. **ATTACHED** - Крюк прикреплен к объекту
4. **RETRACTING** - Крюк возвращается к игроку

### Настраиваемые параметры

- `hook_speed` - Скорость полета крюка (по умолчанию: 1200.0 - увеличена для быстрого действия)
- `max_hook_distance` - Максимальная дальность (по умолчанию: 600.0)
- `hook_size` - Размер коллизии крюка (по умолчанию: 8.0)

## Механика полета

### Фиксированный угол полета

- При клике **запоминается угол** между игроком и курсором
- Крюк летит под этим **фиксированным углом** относительно игрока
- При движении игрока **угол сохраняется** - крюк всегда летит в том же направлении относительно игрока
- Крюк летит до **максимальной дистанции** в выбранном направлении

### Поведение при движении игрока

- Крюк **следует за игроком**, сохраняя первоначальный угол
- Целевая точка крюка = позиция игрока + направление под углом × максимальная дистанция
- При достижении максимальной дистанции крюк автоматически возвращается

### Ограничения дистанции

- Максимальная дистанция считается от **текущей позиции игрока**
- Крюк не может улететь дальше установленного лимита

## Механика доджа

### Основные особенности

- **Активация**: Нажатие пробела при удержании клавиш движения (WASD)
- **Направление**: Додж выполняется в направлении нажатых клавиш движения
- **Условие**: Игрок должен **активно нажимать** клавиши движения (WASD)
- **Перезарядка**: После использования додж недоступен в течение `dodge_cooldown` секунд

### Настраиваемые параметры доджа

- `dodge_force` - Сила доджа (по умолчанию: 800.0)
- `dodge_cooldown` - Время перезарядки в секундах (по умолчанию: 1.0)

### Логика работы

1. **Удерживаете WASD** - игрок готов к доджу
2. **Нажимаете пробел** - выполняется додж в направлении WASD
3. **Отпускаете WASD** - додж недоступен, даже если игрок еще движется по инерции

### Утилитарные методы

- `can_dodge()` - Проверяет возможность выполнения доджа (не на перезарядке + нажаты клавиши движения)
- `is_dodge_on_cooldown()` - Проверяет, на перезарядке ли додж
- `get_dodge_cooldown_remaining()` - Возвращает оставшееся время перезарядки
- `get_dodge_cooldown_progress()` - Возвращает прогресс перезарядки (0.0-1.0)

## Визуальные особенности

### Якорь

- Использует SVG изображение `Assets/Images/Player/anchor.svg`
- Автоматически поворачивается в направлении движения
- Масштабируется до 50% от оригинального размера

### Веревка

- Белого цвета для лучшей видимости
- Ширина линии: 3 пикселя
- Отображается позади других объектов

## Интеграция

### Автоматическое подключение

Система автоматически подключается при создании игрока:

```gdscript
# В player.gd уже есть:
func setup_grappling_integration():
    grappling_integration = PlayerGrapplingIntegration.new()
    add_child(grappling_integration)
    grappling_integration.setup_for_player(self)
```

### Ручное подключение к существующему игроку

```gdscript
# Создаем интеграцию
var grappling_integration = PlayerGrapplingIntegration.new()
player.add_child(grappling_integration)
grappling_integration.setup_for_player(player)
```

### Переопределение методов событий

В скрипте игрока можно переопределить методы для обработки событий крюка:

```gdscript
func on_hook_attached(position: Vector2):
    print("Крюк прикреплен!")
    # Ваша логика

func on_hook_hit_target(body: Node2D):
    if body.is_in_group("enemies"):
        # Логика для врагов
        pass
```

### Создание зацепляемых объектов

Объекты должны иметь коллизию и могут содержать метод `can_be_grappled()`:

```gdscript
extends StaticBody2D

func can_be_grappled() -> bool:
    return true

func on_grappled():
    print("Объект зацеплен!")
```

## Сигналы

- `hook_attached(position: Vector2)` - Крюк прикрепился
- `hook_detached()` - Крюк отсоединился
- `hook_hit_target(body: Node2D)` - Крюк попал в объект

## Методы для расширения

### В GrapplingHook:

- `can_attach_to(body: Node)` - Проверка возможности зацепления
- `get_attachment_point(body: Node)` - Получение точки крепления
- `apply_hook_force(force: Vector2)` - Применение силы к объекту

### В Player:

- `start_swinging_mechanics()` - Механика раскачивания
- `start_pulling_mechanics(target_body)` - Механика подтягивания

## Будущие возможности

Система подготовлена для добавления:

1. **Механика раскачивания** - Игрок может раскачиваться на крюке
2. **Подтягивание к объектам** - Быстрое перемещение к точке крепления
3. **Подтягивание объектов** - Притягивание легких объектов к игроку
4. **Разные типы крюков** - Магнитный, взрывной, временный
5. **Улучшения веревки** - Физическая симуляция, натяжение
6. **Звуковые эффекты** - Звуки запуска, попадания, натяжения

## Отладка

Система выводит отладочную информацию в консоль:

- Запуск крюка и направление
- Попадания в объекты
- Смена состояний

## Требования

- Godot 4.x
- Система должна быть добавлена как дочерний узел основной сцены
- Игрок должен быть типа CharacterBody2D или Node2D
